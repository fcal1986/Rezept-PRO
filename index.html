<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>ReelRecipes</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;0,9..144,700;1,9..144,400&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  DESIGN SYSTEM                                        â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* Palette â€” warm white + deep terracotta + sage */
  --bg:          #FAFAF8;
  --surface:     #FFFFFF;
  --surface2:    #F5F4F1;
  --surface3:    #EDECEA;

  --terra:       #D4522A;   /* primary CTA */
  --terra-light: #FAF0EC;
  --terra-mid:   #F0A080;
  --terra-deep:  #A33918;

  --sage:        #4A7C59;
  --sage-light:  #EDF4F0;

  --amber:       #E8A020;
  --amber-light: #FEF7E8;

  --ink:         #18130E;   /* 95% black-brown */
  --ink2:        #4A3F36;
  --ink3:        #8C7E74;
  --ink4:        #C2B8B0;
  --ink5:        #E8E3DF;

  --error:       #D93025;
  --error-bg:    #FEF2F1;

  --white:       #FFFFFF;
  --black:       #000000;

  /* Type */
  --font-display: 'Fraunces', Georgia, serif;
  --font-body:    'Plus Jakarta Sans', system-ui, sans-serif;
  --font-mono:    'SF Mono', 'Fira Code', monospace;

  /* Spacing */
  --sp1: 4px;  --sp2: 8px;   --sp3: 12px;
  --sp4: 16px; --sp5: 20px;  --sp6: 24px;
  --sp8: 32px; --sp10: 40px; --sp12: 48px;

  /* Radii */
  --r1: 6px;  --r2: 10px;  --r3: 14px;
  --r4: 18px; --r5: 24px;  --r-full: 999px;

  /* Shadows */
  --shadow-xs: 0 1px 3px rgba(24,19,14,.06);
  --shadow-sm: 0 2px 8px rgba(24,19,14,.08);
  --shadow-md: 0 4px 20px rgba(24,19,14,.10);
  --shadow-lg: 0 12px 40px rgba(24,19,14,.14);

  /* Layout */
  --max-w: 480px;
  --nav-h: 68px;
  --topbar-h: 56px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

/* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html { font-size: 16px; }
body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}
button { cursor: pointer; border: none; background: none; font-family: inherit; }
input, textarea, select { font-family: inherit; font-size: inherit; }

/* â”€â”€ App Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app {
  max-width: var(--max-w);
  margin: 0 auto;
  min-height: 100vh;
  background: var(--bg);
  position: relative;
  display: flex;
  flex-direction: column;
}

/* â”€â”€ Screens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.screen { flex: 1; display: none; flex-direction: column; overflow-y: auto; padding-bottom: calc(var(--nav-h) + var(--safe-bottom) + 8px); }
.screen.active { display: flex; animation: screenIn .22s cubic-bezier(.25,.46,.45,.94); }
@keyframes screenIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:none; } }

/* â”€â”€ Bottom Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#bottom-nav {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: var(--max-w);
  height: calc(var(--nav-h) + var(--safe-bottom));
  padding-bottom: var(--safe-bottom);
  background: rgba(255,255,255,.94);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--ink5);
  display: flex;
  z-index: 200;
}
.nav-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  color: var(--ink4);
  font-size: 10px;
  font-weight: 600;
  letter-spacing: .02em;
  transition: color .15s;
  padding-bottom: 2px;
}
.nav-btn svg { width: 24px; height: 24px; stroke: currentColor; fill: none; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; transition: transform .2s; }
.nav-btn.active { color: var(--terra); }
.nav-btn.active svg { stroke: var(--terra); transform: translateY(-1px); }

/* â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  position: sticky;
  top: 0;
  z-index: 100;
  height: var(--topbar-h);
  background: rgba(250,250,248,.95);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--ink5);
  display: flex;
  align-items: center;
  padding: 0 var(--sp4);
  gap: var(--sp3);
}
.topbar-title { font-family: var(--font-display); font-size: 19px; font-weight: 600; color: var(--ink); flex: 1; }
.topbar-back {
  width: 36px; height: 36px; border-radius: var(--r-full);
  background: var(--surface3);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.topbar-back svg { width: 18px; height: 18px; stroke: var(--ink2); fill: none; stroke-width: 2; stroke-linecap: round; }

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast {
  position: fixed;
  bottom: calc(var(--nav-h) + var(--safe-bottom) + 12px);
  left: 50%;
  transform: translateX(-50%) translateY(16px);
  background: var(--ink);
  color: #fff;
  padding: 10px 18px;
  border-radius: var(--r-full);
  font-size: 13px;
  font-weight: 500;
  z-index: 9999;
  opacity: 0;
  transition: all .22s cubic-bezier(.34,1.56,.64,1);
  pointer-events: none;
  white-space: nowrap;
  max-width: calc(var(--max-w) - 32px);
  box-shadow: var(--shadow-lg);
}
#toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  COMPONENTS                                           â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Pill Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; border-radius: var(--r-full); font-weight: 600; transition: all .15s; }
.btn-lg { height: 52px; padding: 0 24px; font-size: 15px; width: 100%; }
.btn-md { height: 42px; padding: 0 18px; font-size: 13px; }
.btn-sm { height: 32px; padding: 0 14px; font-size: 12px; }
.btn-primary { background: var(--terra); color: #fff; box-shadow: 0 4px 14px rgba(212,82,42,.28); }
.btn-primary:active { transform: scale(.97); background: var(--terra-deep); }
.btn-secondary { background: var(--surface3); color: var(--ink2); }
.btn-secondary:active { transform: scale(.97); background: var(--ink5); }
.btn-ghost { background: transparent; color: var(--terra); }
.btn-danger { background: var(--error-bg); color: var(--error); }

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--surface);
  border-radius: var(--r4);
  border: 1px solid var(--ink5);
  overflow: hidden;
  box-shadow: var(--shadow-xs);
}

/* â”€â”€ Label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.label { font-size: 11px; font-weight: 700; letter-spacing: .07em; text-transform: uppercase; color: var(--ink3); }

/* â”€â”€ Chip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chip { display: inline-flex; align-items: center; padding: 6px 14px; border-radius: var(--r-full); font-size: 12px; font-weight: 600; border: 1.5px solid var(--ink5); background: var(--surface); color: var(--ink2); transition: all .15s; white-space: nowrap; }
.chip.active { background: var(--terra); color: #fff; border-color: var(--terra); }
.chip:active { transform: scale(.96); }

/* â”€â”€ Input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.input-field {
  width: 100%;
  background: var(--surface2);
  border: 1.5px solid transparent;
  border-radius: var(--r3);
  padding: 12px 14px;
  font-size: 14px;
  color: var(--ink);
  outline: none;
  transition: border-color .18s, background .18s;
}
.input-field:focus { border-color: var(--terra); background: var(--surface); }
.input-field::placeholder { color: var(--ink4); }
.input-row {
  display: flex;
  align-items: center;
  background: var(--surface2);
  border: 1.5px solid transparent;
  border-radius: var(--r3);
  padding: 0 14px;
  gap: 8px;
  transition: border-color .18s;
}
.input-row:focus-within { border-color: var(--terra); background: var(--surface); }
.input-row input { flex: 1; background: none; border: none; outline: none; font-size: 14px; color: var(--ink); padding: 12px 0; }
.input-row input::placeholder { color: var(--ink4); }

/* â”€â”€ Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section { padding: var(--sp4); }
.section + .section { padding-top: 0; }
.section-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: var(--sp4); }
.section-title { font-family: var(--font-display); font-size: 20px; font-weight: 600; color: var(--ink); }
.section-link { font-size: 13px; font-weight: 600; color: var(--terra); }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  HOME SCREEN                                          â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.home-header {
  padding: var(--sp5) var(--sp4) var(--sp4);
  background: var(--surface);
  border-bottom: 1px solid var(--ink5);
}
.home-wordmark {
  font-family: var(--font-display);
  font-size: 28px;
  font-weight: 700;
  color: var(--ink);
  letter-spacing: -.02em;
  line-height: 1;
  margin-bottom: 2px;
}
.home-wordmark span { color: var(--terra); }
.home-sub { font-size: 13px; color: var(--ink3); }

.input-card {
  background: var(--surface);
  border-radius: var(--r4);
  border: 1px solid var(--ink5);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}
.input-section {
  padding: var(--sp4);
  border-bottom: 1px solid var(--ink5);
}
.input-section:last-of-type { border-bottom: none; }
.input-meta { font-size: 11px; font-weight: 700; letter-spacing: .07em; text-transform: uppercase; color: var(--ink3); margin-bottom: var(--sp2); }

.paste-btn-inline {
  width: 32px; height: 32px; border-radius: var(--r2);
  background: var(--surface3);
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
  transition: background .15s;
}
.paste-btn-inline:active { background: var(--ink5); }

.drop-zone {
  border: 2px dashed var(--ink5);
  border-radius: var(--r3);
  padding: var(--sp5) var(--sp4);
  text-align: center;
  cursor: pointer;
  transition: all .2s;
  background: var(--bg);
}
.drop-zone:hover, .drop-zone.dragover { border-color: var(--terra); background: var(--terra-light); }
.drop-zone.has-file { border-style: solid; border-color: var(--sage); background: var(--sage-light); }
.drop-icon { font-size: 28px; line-height: 1; margin-bottom: var(--sp2); }
.drop-title { font-size: 14px; font-weight: 600; color: var(--ink2); }
.drop-sub { font-size: 11px; color: var(--ink3); margin-top: 3px; }

.hint-strip {
  display: flex;
  align-items: center;
  gap: var(--sp2);
  padding: var(--sp3) var(--sp4);
  background: var(--amber-light);
  border-radius: var(--r3);
  font-size: 12px;
  color: #7A5500;
  line-height: 1.4;
}

/* Recipe card â€” horizontal */
.rcard {
  background: var(--surface);
  border-radius: var(--r3);
  border: 1px solid var(--ink5);
  display: flex;
  align-items: center;
  gap: 0;
  cursor: pointer;
  overflow: hidden;
  box-shadow: var(--shadow-xs);
  transition: transform .12s, box-shadow .12s;
}
.rcard:active { transform: scale(.985); box-shadow: none; }
.rcard-thumb {
  width: 80px;
  height: 80px;
  flex-shrink: 0;
  background: var(--surface2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
}
.rcard-body { flex: 1; min-width: 0; padding: 12px 14px; }
.rcard-title { font-size: 14px; font-weight: 600; color: var(--ink); margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rcard-meta { font-size: 11px; color: var(--ink3); }
.rcard-tags { display: flex; gap: 4px; margin-top: 6px; flex-wrap: wrap; }
.rcard-tag { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: var(--r-full); background: var(--surface2); color: var(--ink3); }
.rcard-arrow { padding: 0 var(--sp3); color: var(--ink4); font-size: 18px; flex-shrink: 0; }

/* Swipe delete wrapper */
.rcard-wrap { position: relative; overflow: hidden; border-radius: var(--r3); }
.rcard-del-bg {
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 80px;
  background: var(--error);
  display: flex; align-items: center; justify-content: center;
  color: #fff; font-size: 20px;
  cursor: pointer;
  border-radius: 0 var(--r3) var(--r3) 0;
}
.rcard-wrap .rcard { position: relative; z-index: 1; transition: transform .28s cubic-bezier(.25,.46,.45,.94); }
.rcard-wrap.swiped .rcard { transform: translateX(-80px); }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  PIPELINE SCREEN                                      â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pipeline-hero {
  padding: var(--sp6) var(--sp4) var(--sp4);
  text-align: center;
}
.pipeline-title { font-family: var(--font-display); font-size: 22px; font-weight: 600; color: var(--ink); }
.pipeline-src { font-size: 11px; color: var(--ink3); margin-top: 6px; font-family: var(--font-mono); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100%; }

.progress-track { height: 3px; background: var(--ink5); border-radius: 99px; overflow: hidden; margin: 0 var(--sp4) var(--sp4); }
.progress-fill { height: 100%; background: linear-gradient(90deg, var(--terra), var(--terra-mid)); border-radius: 99px; transition: width .5s cubic-bezier(.4,0,.2,1); width: 0%; }

.stages-card { margin: 0 var(--sp4) var(--sp4); }
.stage-item { display: flex; align-items: center; gap: var(--sp3); padding: var(--sp3) var(--sp4); }
.stage-item + .stage-item { border-top: 1px solid var(--ink5); }
.stage-dot {
  width: 36px; height: 36px; border-radius: var(--r3);
  background: var(--surface2);
  display: flex; align-items: center; justify-content: center;
  font-size: 16px; flex-shrink: 0;
  transition: all .25s;
}
.stage-dot.active { background: var(--terra-light); animation: pulse .9s infinite; }
.stage-dot.done { background: var(--sage-light); }
.stage-dot.error { background: var(--error-bg); }
.stage-dot.skip { opacity: .4; }
@keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.06); } }
.stage-info { flex: 1; }
.stage-name { font-size: 13px; font-weight: 600; color: var(--ink); }
.stage-detail { font-size: 11px; color: var(--ink3); margin-top: 1px; }
.stage-check { font-size: 16px; flex-shrink: 0; }

.proc-status-text { text-align: center; font-size: 13px; color: var(--ink3); padding: 0 var(--sp4) var(--sp4); min-height: 20px; }

.error-card {
  margin: 0 var(--sp4) var(--sp4);
  background: var(--error-bg);
  border: 1px solid #f5c2be;
  border-radius: var(--r4);
  padding: var(--sp4);
  display: none;
}
.error-title { font-size: 14px; font-weight: 700; color: var(--error); margin-bottom: 6px; }
.error-msg { font-size: 13px; color: #8B2020; line-height: 1.5; }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  DETAIL SCREEN                                        â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.detail-hero-card {
  margin: var(--sp4);
  background: var(--surface);
  border-radius: var(--r5);
  border: 1px solid var(--ink5);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}
.detail-emoji-hero {
  height: 140px;
  background: linear-gradient(135deg, var(--terra-light), var(--amber-light));
  display: flex; align-items: center; justify-content: center;
  font-size: 72px;
  position: relative;
}
.detail-conf-badge {
  position: absolute;
  bottom: 12px; right: 12px;
  display: flex; align-items: center; gap: 5px;
  background: rgba(255,255,255,.9);
  backdrop-filter: blur(8px);
  padding: 4px 10px;
  border-radius: var(--r-full);
  font-size: 11px;
  font-weight: 700;
}
.conf-dot { width: 7px; height: 7px; border-radius: 50%; }
.detail-body { padding: var(--sp4); }
.detail-title { font-family: var(--font-display); font-size: 22px; font-weight: 600; line-height: 1.2; color: var(--ink); margin-bottom: var(--sp3); }
.detail-pills { display: flex; flex-wrap: wrap; gap: var(--sp2); margin-bottom: var(--sp3); }
.detail-pill {
  display: flex; align-items: center; gap: 5px;
  background: var(--surface2);
  padding: 6px 12px;
  border-radius: var(--r-full);
  font-size: 12px;
  font-weight: 600;
  color: var(--ink2);
}

.detail-actions { display: flex; gap: var(--sp2); margin: 0 var(--sp4) var(--sp3); }
.detail-action {
  flex: 1; height: 44px;
  border-radius: var(--r3);
  font-size: 12px;
  font-weight: 700;
  display: flex; align-items: center; justify-content: center; gap: 5px;
  transition: all .15s;
}
.detail-action:active { transform: scale(.97); }
.da-edit { background: var(--surface2); color: var(--ink2); }
.da-delete { background: var(--error-bg); color: var(--error); }
.da-source { background: var(--terra-light); color: var(--terra-deep); }

.detail-tabs {
  display: flex;
  border-bottom: 1px solid var(--ink5);
  background: var(--surface);
  position: sticky;
  top: 0;
  z-index: 50;
}
.dtab {
  flex: 1;
  padding: 13px 4px;
  font-size: 12px;
  font-weight: 700;
  color: var(--ink3);
  border-bottom: 2px solid transparent;
  transition: all .15s;
  letter-spacing: .01em;
}
.dtab.active { color: var(--terra); border-bottom-color: var(--terra); }

.tab-pane { display: none; padding: var(--sp4); }
.tab-pane.active { display: block; animation: fadeIn .15s ease; }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

/* Ingredient row */
.ing-row {
  display: flex; align-items: center; gap: var(--sp3);
  padding: 11px 0;
  border-bottom: 1px solid var(--ink5);
}
.ing-row:last-child { border-bottom: none; }
.ing-cb {
  width: 22px; height: 22px;
  border-radius: 7px;
  border: 2px solid var(--ink5);
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  transition: all .15s;
  font-size: 12px;
}
.ing-cb.checked { background: var(--sage); border-color: var(--sage); color: #fff; }
.ing-name { flex: 1; font-size: 14px; color: var(--ink); transition: opacity .2s; line-height: 1.3; }
.ing-name.done { opacity: .35; text-decoration: line-through; }
.ing-amount { font-family: var(--font-mono); font-size: 12px; font-weight: 500; color: var(--ink3); text-align: right; flex-shrink: 0; }
.ing-unknown { font-family: var(--font-mono); font-size: 10px; padding: 2px 7px; border-radius: 4px; background: var(--surface2); color: var(--ink4); }
.ing-note { font-size: 11px; color: var(--ink3); margin-top: 2px; }

.reset-btn { font-size: 12px; font-weight: 600; color: var(--ink3); padding: 4px 10px; border-radius: var(--r-full); background: var(--surface2); }

/* Step row */
.step-row { display: flex; gap: var(--sp3); padding: 13px 0; border-bottom: 1px solid var(--ink5); }
.step-row:last-child { border-bottom: none; }
.step-num {
  width: 28px; height: 28px; border-radius: var(--r-full);
  background: var(--terra); color: #fff;
  font-size: 12px; font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; margin-top: 1px;
}
.step-text { flex: 1; font-size: 14px; line-height: 1.65; color: var(--ink); }

/* Info row */
.info-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--ink5); }
.info-row:last-child { border-bottom: none; }
.info-lbl { font-size: 13px; color: var(--ink3); }
.info-val { font-size: 13px; font-weight: 600; color: var(--ink); text-align: right; max-width: 60%; }

.notes-area {
  width: 100%;
  background: var(--surface2);
  border: 1.5px solid transparent;
  border-radius: var(--r3);
  padding: 12px;
  font-size: 13px;
  color: var(--ink);
  resize: vertical;
  min-height: 80px;
  outline: none;
  line-height: 1.6;
  transition: border-color .18s;
  margin-top: var(--sp2);
}
.notes-area:focus { border-color: var(--terra); background: var(--surface); }

/* Edit tab */
.edit-ing-row { display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
.edit-step-row { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; }
.field-label { font-size: 11px; font-weight: 700; letter-spacing: .05em; text-transform: uppercase; color: var(--ink3); margin-bottom: 5px; display: block; }
.field-group { flex: 1; min-width: 0; }
.field-input {
  width: 100%;
  background: var(--surface2);
  border: 1.5px solid transparent;
  border-radius: var(--r2);
  padding: 9px 11px;
  font-size: 13px;
  color: var(--ink);
  outline: none;
  transition: border-color .18s;
}
.field-input:focus { border-color: var(--terra); background: var(--surface); }
select.field-input { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24'%3E%3Cpath fill='%23999' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; padding-right: 28px; }
.add-btn { background: var(--terra-light); color: var(--terra-deep); padding: 5px 12px; border-radius: var(--r-full); font-size: 11px; font-weight: 700; }
.del-btn { width: 28px; height: 28px; border-radius: var(--r2); background: var(--error-bg); color: var(--error); font-size: 13px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  COOKBOOK SCREEN                                      â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.search-bar-sticky {
  position: sticky;
  top: 0;
  z-index: 60;
  background: rgba(250,250,248,.95);
  backdrop-filter: blur(16px);
  padding: var(--sp3) var(--sp4);
  border-bottom: 1px solid var(--ink5);
}
.search-wrap {
  display: flex; align-items: center; gap: var(--sp2);
  background: var(--surface2);
  border-radius: var(--r-full);
  padding: 10px 14px;
}
.search-wrap svg { width: 16px; height: 16px; stroke: var(--ink3); fill: none; stroke-width: 2; flex-shrink: 0; }
.search-wrap input { flex: 1; background: none; border: none; outline: none; font-size: 14px; color: var(--ink); }
.search-wrap input::placeholder { color: var(--ink4); }
.search-clear { color: var(--ink4); font-size: 16px; padding: 0 2px; }

.filter-scroll { display: flex; gap: var(--sp2); overflow-x: auto; padding: var(--sp2) var(--sp4); scrollbar-width: none; }
.filter-scroll::-webkit-scrollbar { display: none; }

.cookbook-meta { display: flex; justify-content: space-between; align-items: center; padding: var(--sp2) var(--sp4); }
.cookbook-count { font-size: 12px; color: var(--ink3); }
.sort-btn { font-size: 12px; font-weight: 600; color: var(--terra); }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  SETTINGS SCREEN                                      â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-section { padding: var(--sp3) var(--sp4) 0; }
.settings-section-title { font-size: 11px; font-weight: 700; letter-spacing: .07em; text-transform: uppercase; color: var(--ink3); margin-bottom: var(--sp2); }

.settings-card { background: var(--surface); border-radius: var(--r4); border: 1px solid var(--ink5); overflow: hidden; box-shadow: var(--shadow-xs); margin-bottom: var(--sp4); }
.settings-row { display: flex; align-items: center; justify-content: space-between; padding: 14px var(--sp4); }
.settings-row + .settings-row { border-top: 1px solid var(--ink5); }
.settings-row-label { font-size: 14px; font-weight: 600; color: var(--ink); }
.settings-row-sub { font-size: 12px; color: var(--ink3); margin-top: 2px; }

.key-wrap { position: relative; }
.key-wrap input { padding-right: 44px; }
.key-eye { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 16px; color: var(--ink3); }

.test-result { margin-top: var(--sp2); padding: 10px 12px; border-radius: var(--r3); font-size: 12px; display: none; line-height: 1.4; }
.test-ok { background: var(--sage-light); color: var(--sage); }
.test-fail { background: var(--error-bg); color: var(--error); }

.lang-group { display: flex; gap: var(--sp2); flex-wrap: wrap; }
.lang-btn { padding: 8px 16px; border-radius: var(--r-full); font-size: 13px; font-weight: 600; background: var(--surface2); color: var(--ink3); border: 2px solid transparent; transition: all .15s; }
.lang-btn.active { background: var(--terra); color: #fff; border-color: var(--terra); }

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  DEBUG SCREEN                                         â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.debug-toolbar { padding: var(--sp2) var(--sp4); background: var(--surface); border-bottom: 1px solid var(--ink5); display: flex; gap: var(--sp2); align-items: center; flex-wrap: wrap; }
.debug-toggle-label { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; cursor: pointer; }
.debug-filter-row { display: flex; gap: var(--sp2); overflow-x: auto; padding: var(--sp2) var(--sp4); scrollbar-width: none; border-bottom: 1px solid var(--ink5); }
.debug-log { flex: 1; overflow-y: auto; padding: var(--sp2) var(--sp3); background: #0D1117; color: #E6EDF3; font-family: var(--font-mono); font-size: 11px; }
.dbg-entry { padding: 5px 8px; border-radius: 6px; display: flex; gap: 8px; align-items: flex-start; cursor: pointer; border-left: 3px solid transparent; margin-bottom: 2px; }
.dbg-entry:hover { background: rgba(255,255,255,.05); }
.dbg-entry.info  { border-left-color: #58A6FF; }
.dbg-entry.stage { border-left-color: #3FB950; }
.dbg-entry.api   { border-left-color: #D2A8FF; }
.dbg-entry.error { border-left-color: #F85149; background: rgba(248,81,73,.08); }
.dbg-entry.warn  { border-left-color: #E3B341; }
.dbg-entry.audio { border-left-color: #79C0FF; }
.dbg-time  { color: #8B949E; flex-shrink: 0; font-size: 10px; padding-top: 1px; min-width: 55px; }
.dbg-level { font-size: 10px; font-weight: 700; flex-shrink: 0; min-width: 50px; }
.dbg-msg   { flex: 1; word-break: break-all; white-space: pre-wrap; line-height: 1.5; }
.dbg-detail { display: none; margin-top: 4px; padding: 6px 8px; background: rgba(255,255,255,.05); border-radius: 4px; color: #8B949E; font-size: 10px; white-space: pre-wrap; word-break: break-all; max-height: 300px; overflow-y: auto; }
.dbg-entry.open .dbg-detail { display: block; }

/* â”€â”€ Empty state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: var(--sp4); padding: var(--sp10) var(--sp6); text-align: center; }
.empty-icon { font-size: 52px; opacity: .35; }
.empty-title { font-family: var(--font-display); font-size: 20px; color: var(--ink); font-weight: 600; }
.empty-sub { font-size: 13px; color: var(--ink3); line-height: 1.5; }

/* â”€â”€ Key warning bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.key-warning { display: flex; align-items: center; gap: var(--sp2); padding: 11px var(--sp4); background: #FEF3CD; border-bottom: 1px solid #F5DDA0; font-size: 13px; color: #6B4C00; font-weight: 500; cursor: pointer; }

/* â”€â”€ Util â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mt1{margin-top:var(--sp1)} .mt2{margin-top:var(--sp2)} .mt3{margin-top:var(--sp3)} .mt4{margin-top:var(--sp4)}
.gap2{display:flex;flex-direction:column;gap:var(--sp2)}
.gap3{display:flex;flex-direction:column;gap:var(--sp3)}
.gap4{display:flex;flex-direction:column;gap:var(--sp4)}
.row{display:flex;gap:var(--sp2)}
.flex1{flex:1;min-width:0}
.text-muted{font-size:12px;color:var(--ink3);line-height:1.5}
.tag-mini{font-size:10px;font-weight:600;padding:2px 8px;border-radius:var(--r-full);background:var(--surface2);color:var(--ink3)}
</style>
</head>
<body>
<div id="app">

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  HOME                                                â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-home">
  <div class="home-header">
    <div class="home-wordmark">Reel<span>Recipes</span></div>
    <div class="home-sub">Rezepte aus Videos & Social Media</div>
  </div>
  <div id="key-warning" class="key-warning" onclick="navTo('settings')" style="display:none">
    âš ï¸ Kein API Key hinterlegt â€” Einstellungen Ã¶ffnen
  </div>
  <div style="padding:var(--sp4);display:flex;flex-direction:column;gap:var(--sp3)">
    <div class="input-card">
      <!-- URL -->
      <div class="input-section">
        <div class="input-meta">Link</div>
        <div class="input-row">
          <svg viewBox="0 0 24 24" style="width:16px;height:16px;stroke:var(--ink3);fill:none;stroke-width:2;flex-shrink:0"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>
          <input id="url-input" type="url" placeholder="https://instagram.com/reel/â€¦" autocapitalize="none" autocorrect="off">
          <button id="url-clear-btn" onclick="clearUrl()" style="display:none;color:var(--ink4);font-size:16px">âœ•</button>
          <button class="paste-btn-inline" onclick="pasteUrl()" title="EinfÃ¼gen">ğŸ“‹</button>
        </div>
      </div>
      <!-- Caption -->
      <div class="input-section">
        <div class="input-meta">Beschreibung / Caption</div>
        <div style="position:relative">
          <textarea class="input-field" id="caption-input" rows="3"
            placeholder="Rezepttext, Zutaten oder Caption einfÃ¼genâ€¦&#10;Je mehr Text, desto bessere Ergebnisse."
            style="resize:vertical;min-height:72px"></textarea>
          <button onclick="pasteCaption()" style="position:absolute;top:8px;right:8px;background:var(--surface3);border-radius:var(--r2);padding:5px 7px;font-size:13px;color:var(--ink3)">ğŸ“‹</button>
        </div>
      </div>
      <!-- Video -->
      <div class="input-section">
        <div class="input-meta">Video-Datei <span style="font-weight:400;text-transform:none;letter-spacing:0;color:var(--ink4)">mp4 Â· mov Â· webm</span></div>
        <div class="drop-zone" id="file-drop"
             onclick="document.getElementById('file-input').click()"
             ondragover="onDragOver(event)" ondrop="onDrop(event)" ondragleave="onDragLeave(event)">
          <div class="drop-icon" id="drop-icon">ğŸ¬</div>
          <div class="drop-title" id="drop-text">Video hinzufÃ¼gen</div>
          <div class="drop-sub" id="drop-sub">Tippen oder Datei hineinziehen</div>
        </div>
        <input type="file" id="file-input" accept="video/*,audio/*" style="display:none" onchange="onFileSelected(event)">
      </div>
      <!-- CTA -->
      <div style="padding:var(--sp4)">
        <button class="btn btn-primary btn-lg" onclick="startAnalysis()">
          <svg viewBox="0 0 24 24" style="width:18px;height:18px;stroke:#fff;fill:none;stroke-width:2"><polygon points="5,3 19,12 5,21"/></svg>
          Rezept analysieren
        </button>
      </div>
    </div>

    <div class="hint-strip">
      <span>ğŸ’¡</span>
      <span id="input-hint">Link, Text oder Video â€” die KI erkennt automatisch was vorhanden ist</span>
    </div>

    <!-- Recent -->
    <div id="recent-section" style="display:none">
      <div class="section-header" style="margin-bottom:var(--sp3)">
        <div class="section-title">Zuletzt hinzugefÃ¼gt</div>
        <button class="section-link" onclick="navTo('cookbook')">Alle â†’</button>
      </div>
      <div id="recent-list" class="gap3"></div>
    </div>
  </div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  PIPELINE                                            â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-pipeline">
  <div class="topbar">
    <button class="topbar-back" onclick="cancelPipeline()">
      <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
    <div class="topbar-title">Analyse lÃ¤uft</div>
  </div>
  <div class="pipeline-hero">
    <div class="pipeline-title" id="proc-title">Rezept wird extrahiertâ€¦</div>
    <div class="pipeline-src" id="proc-url"></div>
  </div>
  <div class="progress-track"><div class="progress-fill" id="progress-bar"></div></div>
  <div class="proc-status-text" id="proc-status">Vorbereitungâ€¦</div>
  <div class="stages-card card" style="margin:0 var(--sp4) var(--sp4)">
    <div id="stages-list"></div>
  </div>
  <div class="error-card" id="proc-error">
    <div class="error-title" id="proc-error-title">Fehler</div>
    <div class="error-msg" id="proc-error-msg"></div>
    <button class="btn btn-secondary btn-md" onclick="navTo('home')" style="margin-top:var(--sp3);width:100%">â† ZurÃ¼ck & nochmal versuchen</button>
  </div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  DETAIL                                              â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-detail" style="padding-bottom:0">
  <div class="topbar">
    <button class="topbar-back" onclick="goBack()">
      <svg viewBox="0 0 24 24"><polyline points="15,18 9,12 15,6"/></svg>
    </button>
    <div class="topbar-title" id="detail-topbar-title">Rezept</div>
  </div>

  <div style="flex:1;overflow-y:auto;padding-bottom:calc(var(--nav-h) + var(--safe-bottom) + 8px)">
    <!-- Hero card -->
    <div style="padding:var(--sp4) var(--sp4) 0">
      <div class="detail-hero-card">
        <div class="detail-emoji-hero" id="detail-emoji-hero">
          <span id="detail-emoji">ğŸ½ï¸</span>
          <div class="detail-conf-badge" id="detail-conf-badge">
            <div class="conf-dot" id="conf-dot"></div>
            <span id="conf-text"></span>
          </div>
        </div>
        <div class="detail-body">
          <div class="detail-title" id="detail-title">â€”</div>
          <div class="detail-pills" id="detail-pills"></div>
          <div id="detail-source-strip" style="display:none;font-size:12px;color:var(--terra);font-weight:600;cursor:pointer" onclick="openSource()">
            ğŸ”— <span id="detail-source-url-text"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Action row -->
    <div class="detail-actions" style="margin-top:var(--sp3)">
      <button class="detail-action da-edit" onclick="doEditTab()">âœï¸ Bearbeiten</button>
      <button class="detail-action da-delete" onclick="deleteCurrentRecipe()">ğŸ—‘ LÃ¶schen</button>
      <button class="detail-action da-source" id="detail-source-btn" style="display:none" onclick="openSource()">ğŸ”— Quelle</button>
    </div>

    <!-- Tabs -->
    <div class="detail-tabs" style="margin-top:var(--sp1)">
      <button class="dtab active" onclick="switchTab('ingredients',this)">Zutaten</button>
      <button class="dtab" onclick="switchTab('steps',this)">Zubereitung</button>
      <button class="dtab" onclick="switchTab('info',this)">Info</button>
      <button class="dtab" onclick="switchTab('edit',this)">Edit</button>
    </div>
    <div id="tab-ingredients" class="tab-pane active"></div>
    <div id="tab-steps" class="tab-pane"></div>
    <div id="tab-info" class="tab-pane"></div>
    <div id="tab-edit" class="tab-pane"></div>
  </div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  COOKBOOK                                            â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-cookbook">
  <div class="topbar"><div class="topbar-title">Rezeptbuch</div></div>
  <div class="search-bar-sticky">
    <div class="search-wrap">
      <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="search-input" placeholder="Titel, Zutat oder KÃ¼cheâ€¦" oninput="renderCookbook()">
      <button class="search-clear" id="search-clear" onclick="clearSearch()" style="display:none">âœ•</button>
    </div>
  </div>
  <div class="filter-scroll" id="filter-row"></div>
  <div class="cookbook-meta">
    <span class="cookbook-count" id="recipe-count-label"></span>
    <button class="sort-btn" id="sort-toggle" onclick="toggleSort()">â†“ Neueste</button>
  </div>
  <div id="cookbook-list" style="padding:0 var(--sp4) var(--sp4);display:flex;flex-direction:column;gap:var(--sp2);flex:1"></div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  SETTINGS                                            â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-settings">
  <div class="topbar"><div class="topbar-title">Einstellungen</div></div>
  <div style="padding:var(--sp4);display:flex;flex-direction:column;gap:var(--sp4)">

    <div>
      <div class="settings-section-title">Groq API Key</div>
      <div class="settings-card">
        <div style="padding:var(--sp4)">
          <p class="text-muted" style="margin-bottom:var(--sp3)">
            Kostenlos unter <strong style="color:var(--terra)">console.groq.com</strong> â€” kein Kreditkarte nÃ¶tig.<br>Key beginnt mit <code style="background:var(--surface2);padding:1px 5px;border-radius:4px;font-size:11px">gsk_â€¦</code>
          </p>
          <div class="key-wrap">
            <input type="password" id="key-input" class="input-field" placeholder="gsk_â€¦" autocomplete="off">
            <button class="key-eye" onclick="toggleKeyVisibility()" id="key-eye">ğŸ‘</button>
          </div>
          <div style="display:flex;gap:var(--sp2);margin-top:var(--sp3)">
            <button class="btn btn-secondary btn-md" style="flex:1" onclick="saveKey()">ğŸ’¾ Speichern</button>
            <button class="btn btn-secondary btn-md" style="flex:1" onclick="testApiKey()" id="test-key-btn">ğŸ”— Testen</button>
          </div>
          <div id="test-result" class="test-result"></div>
        </div>
      </div>
    </div>

    <div>
      <div class="settings-section-title">Ausgabesprache</div>
      <div class="settings-card">
        <div style="padding:var(--sp4)">
          <p class="text-muted" style="margin-bottom:var(--sp3)">In welcher Sprache sollen Zutaten und Schritte ausgegeben werden?</p>
          <div class="lang-group" id="lang-selector">
            <button class="lang-btn" data-lang="original" onclick="setLangPref('original',this)">ğŸŒ Original</button>
            <button class="lang-btn" data-lang="de" onclick="setLangPref('de',this)">ğŸ‡©ğŸ‡ª Deutsch</button>
            <button class="lang-btn" data-lang="en" onclick="setLangPref('en',this)">ğŸ‡¬ğŸ‡§ English</button>
          </div>
        </div>
      </div>
    </div>

    <div>
      <div class="settings-section-title">Daten</div>
      <div class="settings-card">
        <div class="settings-row">
          <div>
            <div class="settings-row-label">Gespeicherte Rezepte</div>
            <div class="settings-row-sub" id="recipes-count-setting">â€”</div>
          </div>
        </div>
        <div class="settings-row">
          <div>
            <div class="settings-row-label" style="color:var(--error)">Alle Rezepte lÃ¶schen</div>
            <div class="settings-row-sub">Kann nicht rÃ¼ckgÃ¤ngig gemacht werden</div>
          </div>
          <button class="btn btn-danger btn-sm" onclick="deleteAllRecipes()">LÃ¶schen</button>
        </div>
        <div class="settings-row" style="border-bottom:none">
          <div><div class="settings-row-label" style="color:var(--error)">API Key lÃ¶schen</div></div>
          <button class="btn btn-danger btn-sm" onclick="deleteKey()">LÃ¶schen</button>
        </div>
      </div>
    </div>

    <div>
      <div class="settings-section-title">Entwickler</div>
      <div class="settings-card">
        <div class="settings-row" style="border-bottom:none">
          <div>
            <div class="settings-row-label">Debug-Modus</div>
            <div class="settings-row-sub">Pipeline-Logs & API-Anfragen</div>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="navTo('debug');setTimeout(refreshDebugScreen,50)">ğŸ› Ã–ffnen</button>
        </div>
      </div>
    </div>

    <div>
      <div class="settings-section-title">Ãœber</div>
      <div class="settings-card">
        <div class="settings-row"><div class="settings-row-label">Version</div><div style="font-size:13px;font-weight:600;color:var(--ink)">2.1.0</div></div>
        <div class="settings-row"><div class="settings-row-label">KI-Modell</div><div style="font-size:11px;font-weight:600;font-family:var(--font-mono);color:var(--ink3)">llama-3.3-70b-versatile</div></div>
        <div class="settings-row" style="border-bottom:none">
          <div class="settings-row-label">Datenschutz</div>
          <div class="text-muted" style="text-align:right;font-size:11px">Alle Daten lokal<br>im Browser</div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  DEBUG                                               â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-debug" style="padding-bottom:0">
  <div class="topbar">
    <button class="topbar-back" onclick="navTo('settings')">
      <svg viewBox="0 0 24 24"><polyline points="15,18 9,12 15,6"/></svg>
    </button>
    <div class="topbar-title">ğŸ› Debug Log</div>
    <button class="btn btn-secondary btn-sm" onclick="clearDebugLog()" style="font-size:11px">LÃ¶schen</button>
  </div>
  <div class="debug-toolbar">
    <label class="debug-toggle-label">
      <input type="checkbox" id="debug-enabled-toggle" onchange="toggleDebugMode()" style="accent-color:var(--terra)">
      Debug aktiv
    </label>
    <span style="flex:1"></span>
    <button class="btn btn-secondary btn-sm" onclick="copyDebugLog()" style="font-size:11px">ğŸ“‹ Kopieren</button>
    <button class="btn btn-secondary btn-sm" onclick="downloadDebugLog()" style="font-size:11px">â¬‡ï¸ Download</button>
  </div>
  <div class="debug-filter-row" id="debug-filter-row">
    <button class="chip active" onclick="setDebugFilter('all',this)">Alle</button>
    <button class="chip" onclick="setDebugFilter('info',this)">â„¹ï¸ Info</button>
    <button class="chip" onclick="setDebugFilter('stage',this)">âš™ï¸ Stage</button>
    <button class="chip" onclick="setDebugFilter('api',this)">ğŸ¤– API</button>
    <button class="chip" onclick="setDebugFilter('error',this)">ğŸ”´ Fehler</button>
    <button class="chip" onclick="setDebugFilter('audio',this)">ğŸ™ Audio</button>
  </div>
  <div id="debug-log-list" class="debug-log">
    <div style="color:#8B949E;padding:8px 0">â€” Debug-Log leer â€”</div>
  </div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  BOTTOM NAV                                          â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="bottom-nav">
  <button class="nav-btn active" id="nav-home" onclick="navTo('home')">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>
    Home
  </button>
  <button class="nav-btn" id="nav-cookbook" onclick="navTo('cookbook')">
    <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
    Rezeptbuch
  </button>
  <button class="nav-btn" id="nav-settings" onclick="navTo('settings')">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    Einstellungen
  </button>
</nav>
</div><!-- #app -->

<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA & STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const SETTINGS_KEY = 'reelrecipes_settings';
const RECIPES_KEY  = 'reelrecipes_recipes';

function getSettings() {
  try { return JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}'); } catch { return {}; }
}
function saveSettings(s) { localStorage.setItem(SETTINGS_KEY, JSON.stringify(s)); }
function getApiKey() { return getSettings().groq_key || ''; }
function setApiKey(k) { const s = getSettings(); s.groq_key = k; saveSettings(s); }

function getRecipes() {
  try { return JSON.parse(localStorage.getItem(RECIPES_KEY) || '[]'); } catch { return []; }
}
function saveRecipes(arr) { localStorage.setItem(RECIPES_KEY, JSON.stringify(arr)); }
function getRecipeById(id) { return getRecipes().find(r => r.id === id); }
function upsertRecipe(recipe) {
  const all = getRecipes();
  const idx = all.findIndex(r => r.id === recipe.id);
  if (idx >= 0) all[idx] = recipe; else all.unshift(recipe);
  saveRecipes(all);
}
function newId() { return 'r_' + Date.now() + '_' + Math.random().toString(36).slice(2,6); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let currentScreen = 'home';
let prevScreen = 'home';
let currentDetailId = null;
const NAV_SCREENS = ['home','cookbook','settings'];

function navTo(name) {
  prevScreen = currentScreen;
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  const nb = document.getElementById('nav-' + name);
  if (nb) nb.classList.add('active');
  document.getElementById('bottom-nav').style.display = NAV_SCREENS.includes(name) ? 'flex' : 'none';
  currentScreen = name;
  if (name === 'home') refreshHome();
  if (name === 'cookbook') renderCookbook();
  if (name === 'settings') refreshSettings();
  if (name === 'debug') refreshDebugScreen();
}

function goBack() {
  navTo(NAV_SCREENS.includes(prevScreen) ? prevScreen : 'home');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let toastTimer = null;
function showToast(msg, dur = 2600) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), dur);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const urlInput = document.getElementById('url-input');
urlInput.addEventListener('input', () => {
  document.getElementById('url-clear-btn').style.display = urlInput.value ? 'block' : 'none';
});

const searchInputEl = document.getElementById('search-input');
if (searchInputEl) {
  searchInputEl.addEventListener('input', () => {
    document.getElementById('search-clear').style.display = searchInputEl.value ? 'block' : 'none';
  });
}

function clearUrl() { urlInput.value = ''; document.getElementById('url-clear-btn').style.display = 'none'; urlInput.focus(); }
function clearSearch() { searchInputEl.value = ''; document.getElementById('search-clear').style.display = 'none'; renderCookbook(); }

async function pasteUrl() {
  try {
    const t = await navigator.clipboard.readText();
    if (t.trim().startsWith('http')) {
      urlInput.value = t.trim();
      document.getElementById('url-clear-btn').style.display = 'block';
    } else { showToast('Kein Link in Zwischenablage'); }
  } catch { showToast('Zugriff verweigert'); }
}

async function pasteCaption() {
  try {
    const t = await navigator.clipboard.readText();
    if (t.trim()) {
      const el = document.getElementById('caption-input');
      el.value = t.trim();
      el.style.borderColor = 'var(--terra)';
      setTimeout(() => el.style.borderColor = '', 800);
    } else { showToast('Zwischenablage leer'); }
  } catch { showToast('Zugriff verweigert'); }
}

// File handling
let selectedFile = null;
function onDragOver(e) { e.preventDefault(); document.getElementById('file-drop').classList.add('dragover'); }
function onDragLeave() { document.getElementById('file-drop').classList.remove('dragover'); }
function onDrop(e) { e.preventDefault(); document.getElementById('file-drop').classList.remove('dragover'); const f = e.dataTransfer.files[0]; if (f) applyFile(f); }
function onFileSelected(e) { const f = e.target.files[0]; if (f) applyFile(f); }
function applyFile(f) {
  selectedFile = f;
  const z = document.getElementById('file-drop');
  z.classList.add('has-file');
  document.getElementById('drop-icon').textContent = 'âœ…';
  document.getElementById('drop-text').textContent = f.name;
  document.getElementById('drop-sub').textContent = (f.size/1024/1024).toFixed(1) + ' MB Â· bereit';
  showToast('ğŸ“ ' + f.name);
}
function clearFile() {
  selectedFile = null;
  const z = document.getElementById('file-drop');
  z.classList.remove('has-file');
  document.getElementById('drop-icon').textContent = 'ğŸ¬';
  document.getElementById('drop-text').textContent = 'Video hinzufÃ¼gen';
  document.getElementById('drop-sub').textContent = 'Tippen oder Datei hineinziehen';
  document.getElementById('file-input').value = '';
}

function refreshHome() {
  document.getElementById('key-warning').style.display = getApiKey() ? 'none' : 'flex';
  const recent = getRecipes().slice(0, 3);
  const sec = document.getElementById('recent-section');
  if (!recent.length) { sec.style.display = 'none'; return; }
  sec.style.display = 'block';
  document.getElementById('recent-list').innerHTML = recent.map(r => recipeCardHTML(r, false)).join('');
}

function startAnalysis() {
  if (!getApiKey()) { showToast('Bitte zuerst API Key eintragen'); navTo('settings'); return; }
  const url = urlInput.value.trim();
  const caption = document.getElementById('caption-input').value.trim();
  if (!url && !caption && !selectedFile) { showToast('Bitte Link, Text oder Video eingeben'); return; }
  if (url && !url.startsWith('http')) { showToast('Link muss mit https:// beginnen'); return; }
  const parts = [];
  if (url) parts.push('ğŸ”— Link');
  if (caption) parts.push('ğŸ“ Text');
  if (selectedFile) parts.push('ğŸ¬ Video');
  document.getElementById('input-hint').textContent = parts.join(' + ') + ' wird analysiertâ€¦';
  runPipeline(url, caption, selectedFile);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PIPELINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let pipelineAborted = false;

const STAGES_DEF = [
  { key:'input_check',   icon:'ğŸ”', label:'Eingabe prÃ¼fen',         detail:'URL Â· Text Â· Datei' },
  { key:'audio_extract', icon:'ğŸ”Š', label:'Audio extrahieren',       detail:'Browser Â· Direktmodus' },
  { key:'transcribe',    icon:'ğŸ™ï¸', label:'Transkription',           detail:'Groq Whisper' },
  { key:'merge',         icon:'ğŸ§©', label:'Signale zusammenfÃ¼hren',  detail:'Caption + Transkript' },
  { key:'extract',       icon:'ğŸ¤–', label:'Rezept extrahieren',      detail:'Llama 3.3 70B' },
  { key:'validate',      icon:'âœ…', label:'Anti-Halluzination',      detail:'Mengen & Einheiten prÃ¼fen' },
  { key:'save',          icon:'ğŸ’¾', label:'Speichern',               detail:'localStorage' },
];

function cancelPipeline() { pipelineAborted = true; navTo('home'); }

function buildPipelineUI(stageKeys) {
  const list = document.getElementById('stages-list');
  list.innerHTML = stageKeys.map(key => {
    const def = STAGES_DEF.find(s => s.key === key);
    return `<div class="stage-item" id="stage-item-${key}">
      <div class="stage-dot" id="stage-dot-${key}"><span id="stage-emoji-${key}">${def.icon}</span></div>
      <div class="stage-info">
        <div class="stage-name">${def.label}</div>
        <div class="stage-detail">${def.detail}</div>
      </div>
      <div class="stage-check" id="stage-check-${key}"></div>
    </div>`;
  }).join('');
}

function setStage(key, state) {
  const dot   = document.getElementById('stage-dot-' + key);
  const check = document.getElementById('stage-check-' + key);
  if (!dot) return;
  dot.className = 'stage-dot ' + state;
  if (state === 'done')  { check.textContent = 'âœ“'; check.style.color = 'var(--sage)'; }
  if (state === 'error') { check.textContent = 'âœ—'; check.style.color = 'var(--error)'; }
  if (state === 'skip')  { check.textContent = 'â€”'; check.style.color = 'var(--ink4)'; }
  if (state === 'active'|| state === 'idle') { check.textContent = ''; }
}

function setProgress(pct) { document.getElementById('progress-bar').style.width = pct + '%'; }
function setStatus(msg)    { document.getElementById('proc-status').textContent = msg; }
function showProcError(title, msg) {
  const box = document.getElementById('proc-error');
  document.getElementById('proc-error-title').textContent = title;
  document.getElementById('proc-error-msg').textContent = msg;
  box.style.display = 'block';
}

async function runPipeline(url, caption, file) {
  pipelineAborted = false;
  debugLog = [];
  debugEnabled = isDebugEnabled();
  navTo('pipeline');
  document.getElementById('bottom-nav').style.display = 'none';
  document.getElementById('proc-url').textContent = url || (file ? file.name : caption.slice(0,60) + 'â€¦');
  document.getElementById('proc-error').style.display = 'none';
  setProgress(0);

  dbg('info', 'â•â•â• Pipeline gestartet â•â•â•');
  dbg('info', 'URL: ' + (url||'â€”'));
  dbg('info', 'Caption LÃ¤nge: ' + caption.length + ' Zeichen');
  dbg('info', 'Datei: ' + (file ? file.name + ' (' + (file.size/1024).toFixed(0) + ' KB, ' + file.type + ')' : 'â€”'));

  const hasFile = !!file;
  const stageKeys = ['input_check'];
  if (hasFile) stageKeys.push('audio_extract', 'transcribe');
  stageKeys.push('merge', 'extract', 'validate', 'save');
  buildPipelineUI(stageKeys);
  stageKeys.forEach(k => setStage(k, 'idle'));

  let transcript = '';

  try {
    // INPUT CHECK
    setStage('input_check', 'active');
    setStatus('Eingabe wird geprÃ¼ftâ€¦');
    await delay(300);
    if (!url && !caption && !file) throw new Error('Keine Eingabe vorhanden');
    dbg('stage', 'INPUT_CHECK âœ“ â€” Eingabe validiert');
    setStage('input_check', 'done');
    setProgress(10);

    if (hasFile) {
      // AUDIO EXTRACT
      setStage('audio_extract', 'active');
      setStatus('Audio wird vorbereitetâ€¦');
      dbg('audio', 'Audio-Extraktion startet', {fileName:file.name, fileSize:file.size, fileType:file.type});
      let audioBlob = null;
      try {
        audioBlob = await extractAudioFromFile(file);
        dbg('audio', 'Audio extrahiert', {blobSize:audioBlob?.size, blobType:audioBlob?.type});
        setStage('audio_extract', 'done');
        setProgress(30);
      } catch(e) {
        dbg('error', 'Audio-Extraktion fehlgeschlagen', e?.message || String(e));
        setStage('audio_extract', 'error');
        setStatus('Audio-Extraktion fehlgeschlagen â€” Fallbackâ€¦');
        await delay(800);
      }

      // TRANSCRIBE
      setStage('transcribe', 'active');
      setStatus('Audio wird transkribiertâ€¦');
      if (audioBlob) {
        try {
          transcript = await transcribeWithGroqWhisper(audioBlob);
          dbg('audio', 'Whisper Transkription âœ“', {chars:transcript.length, preview:transcript.slice(0,200)});
          setStage('transcribe', 'done');
        } catch(e) {
          dbg('error', 'Whisper fehlgeschlagen', e.message);
          try { transcript = await transcribeWithSpeechAPI(file); setStage('transcribe', 'done'); }
          catch(e2) { transcript = await askForManualTranscript(); setStage('transcribe', transcript ? 'done' : 'skip'); }
        }
      } else {
        try { transcript = await transcribeWithSpeechAPI(file); setStage('transcribe', 'done'); }
        catch(e) { transcript = await askForManualTranscript(); setStage('transcribe', transcript ? 'done' : 'skip'); }
      }
      setProgress(55);
    }

    // MERGE
    setStage('merge', 'active');
    setStatus('Signale werden zusammengefÃ¼hrtâ€¦');
    await delay(200);
    const langPref = getSettings().language_pref || 'original';
    const mergedContext = buildContext(url, caption, transcript, langPref);
    dbg('stage', 'MERGE âœ“', {url:!!url, caption_chars:caption.length, transcript_chars:transcript.length, total_chars:mergedContext.length, preview:mergedContext.slice(0,300)});
    setStage('merge', 'done');
    setProgress(65);

    // EXTRACT
    setStage('extract', 'active');
    setStatus('Rezept wird mit KI extrahiertâ€¦');
    dbg('api', 'Groq Extract â€” Prompt wird gesendet', mergedContext.slice(0,1000));
    const rawResult = await callGroqExtract(mergedContext, url);
    dbg('api', 'Groq Extract â€” Antwort erhalten', rawResult);
    setStage('extract', 'done');
    setProgress(80);

    // VALIDATE
    setStage('validate', 'active');
    setStatus('Mengen & Einheiten werden validiertâ€¦');
    dbg('api', 'Groq Validate â€” wird geprÃ¼ft', rawResult);
    const validated = await callGroqValidate(rawResult);
    dbg('api', 'Groq Validate â€” bereinigt', validated);
    setStage('validate', 'done');
    setProgress(90);

    // SAVE
    setStage('save', 'active');
    setStatus('Wird gespeichertâ€¦');
    dbg('stage', 'SAVE', {title:validated.title, ingredients:(validated.ingredients||[]).length, steps:(validated.steps||[]).length, confidence:validated.confidence});

    const recipe = {
      id: newId(),
      title: validated.title || 'Unbekanntes Rezept',
      cuisine: validated.cuisine || null,
      duration_min: validated.duration_min || null,
      servings: validated.servings || null,
      difficulty: validated.difficulty || null,
      ingredients: (validated.ingredients || []).map((ing, i) => ({ id:'i'+i, ...ing })),
      steps: (validated.steps || []).map((s, i) => ({ id:'s'+i, text: s.text || s.description || '' })),
      tags: validated.tags || [],
      source: { platform: detectPlatform(url), url: url || null, caption: caption || null },
      transcript: { text: transcript || null, method: transcript ? 'auto' : null },
      is_recipe: validated.is_recipe !== false,
      confidence: validated.confidence || 0,
      reason: validated.reason || '',
      created_at: new Date().toISOString(),
      updated_at: new Date().toISOString(),
      notes: '',
    };

    upsertRecipe(recipe);
    currentDetailId = recipe.id;
    setStage('save', 'done');
    setProgress(100);
    setStatus('Fertig! ğŸ‰');
    await delay(600);

    clearFile();
    urlInput.value = '';
    document.getElementById('caption-input').value = '';
    document.getElementById('url-clear-btn').style.display = 'none';
    showDetail(recipe.id);

  } catch(e) {
    if (pipelineAborted) return;
    dbg('error', 'Pipeline-Fehler: ' + e.message, e.stack || '');
    console.error('ReelRecipes pipeline error:', e);
    showProcError('Analyse fehlgeschlagen', e.message);
    setStatus('Fehler aufgetreten');
  }
}

function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

function buildContext(url, caption, transcript, langPref = 'original') {
  const parts = [];
  if (caption) parts.push('CAPTION/BESCHREIBUNG:\n' + caption);
  if (transcript) parts.push('TRANSKRIPT (Audio):\n' + transcript);
  if (url) parts.push('QUELLE-URL: ' + url);
  if (langPref && langPref !== 'original') {
    parts.push('AUSGABESPRACHE: Ãœbersetze alle Zutaten, Schritte und Tags ins ' + (langPref === 'de' ? 'Deutsche' : langPref === 'en' ? 'Englische' : langPref) + '.');
  }
  return parts.join('\n\n') || '[Kein Kontext verfÃ¼gbar]';
}

function detectPlatform(url) {
  if (!url) return null;
  if (url.includes('instagram.com')) return 'instagram';
  if (url.includes('tiktok.com')) return 'tiktok';
  if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';
  if (url.includes('pinterest')) return 'pinterest';
  return 'web';
}

function extractCreatorFromUrl(url) {
  if (!url) return null;
  const m = url.match(/instagram\.com\/([^\/\?]+)/);
  if (m && m[1] !== 'reel' && m[1] !== 'p') return m[1];
  const t = url.match(/tiktok\.com\/@([^\/\?]+)/);
  if (t) return t[1];
  return null;
}

// â”€â”€ Audio extraction â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function extractAudioFromFile(file) {
  const MAX_SIZE = 25 * 1024 * 1024;
  dbg('audio', 'Direktmodus: Datei wird direkt an Whisper gesendet', {
    size: file.size, type: file.type, withinLimit: file.size <= MAX_SIZE
  });
  if (file.size > MAX_SIZE) {
    dbg('audio', 'Datei > 25 MB â€” wird auf 25 MB gekÃ¼rzt');
    return file.slice(0, MAX_SIZE, file.type);
  }
  return file;
}

function getSupportedMime() {
  const types = ['audio/webm;codecs=opus','audio/webm','audio/ogg','audio/mp4'];
  for (const t of types) { if (MediaRecorder.isTypeSupported(t)) return t; }
  return '';
}

async function transcribeWithGroqWhisper(audioBlob) {
  const key = getApiKey();
  const form = new FormData();
  const ext = audioBlob.type?.includes('mp4') ? 'mp4' : audioBlob.type?.includes('webm') ? 'webm' : audioBlob.type?.includes('ogg') ? 'ogg' : 'mp4';
  const filename = 'audio.' + ext;
  dbg('audio', 'Whisper Upload', {filename, size:audioBlob.size, type:audioBlob.type});
  form.append('file', audioBlob, filename);
  form.append('model', 'whisper-large-v3-turbo');
  form.append('response_format', 'text');

  const res = await fetch('https://api.groq.com/openai/v1/audio/transcriptions', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + key },
    body: form,
  });
  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    dbg('error', 'Whisper Fehler ' + res.status, err);
    throw new Error('Whisper: ' + (err?.error?.message || res.status));
  }
  const text = await res.text();
  dbg('audio', 'Whisper Rohantwort', {length:text.length, preview:text.slice(0,300)});
  return text.trim();
}

function transcribeWithSpeechAPI(file) {
  return new Promise((resolve, reject) => {
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SR) { reject(new Error('SpeechRecognition nicht verfÃ¼gbar')); return; }
    const rec = new SR();
    rec.continuous = true; rec.interimResults = false; rec.lang = 'de-DE';
    let transcript = '';
    rec.onresult = e => { for (let i = e.resultIndex; i < e.results.length; i++) { if (e.results[i].isFinal) transcript += e.results[i][0].transcript + ' '; } };
    rec.onerror = e => reject(e);
    rec.onend = () => resolve(transcript.trim());
    const url = URL.createObjectURL(file);
    const audio = document.createElement('audio');
    audio.src = url;
    audio.play().then(() => { rec.start(); });
    audio.onended = () => { rec.stop(); URL.revokeObjectURL(url); };
    setTimeout(() => { rec.stop(); }, 300000);
  });
}

function askForManualTranscript() {
  return new Promise(resolve => {
    const overlay = document.createElement('div');
    overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:999;display:flex;align-items:flex-end;justify-content:center;padding:16px';
    overlay.innerHTML = `
      <div style="background:#fff;border-radius:20px 20px 16px 16px;padding:24px;width:100%;max-width:480px;box-shadow:0 12px 40px rgba(0,0,0,.2)">
        <div style="font-family:var(--font-display);font-size:18px;font-weight:600;margin-bottom:6px">Transkript einfÃ¼gen</div>
        <div style="font-size:13px;color:var(--ink3);margin-bottom:12px">Transkription fehlgeschlagen. Bitte Text manuell einfÃ¼gen oder leer lassen.</div>
        <textarea id="manual-transcript" class="input-field" rows="4" placeholder="Optionaler Rezepttextâ€¦" style="resize:vertical"></textarea>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button style="flex:1;height:48px;border-radius:99px;background:var(--terra);color:#fff;font-weight:700;font-size:14px" onclick="window._resolveTranscript()">Weiter</button>
          <button style="flex:1;height:48px;border-radius:99px;background:var(--surface2);color:var(--ink2);font-weight:700;font-size:14px" onclick="window._skipTranscript()">Ãœberspringen</button>
        </div>
      </div>`;
    document.body.appendChild(overlay);
    window._resolveTranscript = () => { const v = document.getElementById('manual-transcript').value.trim(); document.body.removeChild(overlay); resolve(v); };
    window._skipTranscript = () => { document.body.removeChild(overlay); resolve(''); };
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GROQ API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function callGroq(messages, json_mode = true) {
  const key = getApiKey();
  if (!key) throw new Error('Kein API Key');
  const body = { model:'llama-3.3-70b-versatile', temperature:0.1, max_tokens:2500, messages };
  if (json_mode) body.response_format = { type:'json_object' };
  dbg('api', 'Groq API Request', {model:body.model, messages_count:body.messages.length, json_mode});
  let res;
  try {
    res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
      method: 'POST',
      headers: { 'Content-Type':'application/json', 'Authorization':'Bearer ' + key },
      body: JSON.stringify(body),
    });
  } catch(e) {
    dbg('error', 'Groq Netzwerkfehler', e.message);
    throw new Error('Groq nicht erreichbar: ' + e.message);
  }
  if (!res.ok) {
    let msg = 'Groq HTTP ' + res.status;
    let errBody = '';
    try { const j = await res.json(); msg = j?.error?.message || msg; errBody = JSON.stringify(j); } catch {}
    dbg('error', 'Groq API Fehler ' + res.status, errBody || msg);
    throw new Error(msg);
  }
  const data = await res.json();
  const raw = data.choices?.[0]?.message?.content || '{}';
  return safeJsonParse(raw);
}

function safeJsonParse(str) {
  try { return JSON.parse(str); } catch {}
  const match = str.match(/\{[\s\S]*\}/);
  if (match) { try { return JSON.parse(match[0]); } catch {} }
  return {};
}

async function callGroqExtract(context, url) {
  const system = `Du bist ein prÃ¤ziser Kochrezept-Extraktions-Agent.

ABSOLUTE REGELN:
1. ERFINDE NIEMALS Mengenangaben. amount: null wenn nicht explizit im Text
2. ERFINDE NIEMALS Einheiten. unit: null wenn nicht genannt
3. ERFINDE KEINE Schritte die nicht im Text stehen
4. ERFINDE KEINE Temperaturen, Zeiten, Zutaten
5. Antworte NUR mit validem JSON

Gib aus:
{
  "is_recipe": true/false,
  "confidence": 0.0-1.0,
  "reason": "BegrÃ¼ndung",
  "title": "Titel oder null",
  "cuisine": "z.B. Italienisch oder null",
  "difficulty": "easy"|"medium"|"hard"|null,
  "duration_min": Zahl oder null,
  "servings": Zahl oder null,
  "tags": ["max 5 Tags"],
  "ingredients": [{"name":"...","amount": Zahl_oder_null,"unit":"...oder null","note":"...oder null","confidence":0.0-1.0}],
  "steps": [{"id":"s0","text":"..."}]
}`;
  const user = `Analysiere den folgenden Inhalt und extrahiere das Rezept:

${context}

WICHTIG:
- amount/unit MÃœSSEN null sein wenn nicht klar im Text genannt. Lieber null als erfunden.
- Extrahiere auch gesprochene Mengenangaben (z.B. "eine Tasse", "30 StÃ¼ck", "15 Gramm", "ein EsslÃ¶ffel") als amount+unit.
- Extrahiere servings aus Aussagen wie "ne vengono una trentina" â†’ servings: 30, oder "per 4 persone" â†’ servings: 4.
- Extrahiere duration_min aus Aussagen wie "un'ora" â†’ 60, "20 minuti" â†’ 20, "30 minutes" â†’ 30.
- Behalte die Originalsprache des Textes fÃ¼r Zutaten und Schritte bei.`;
  return callGroq([{ role:'system', content:system }, { role:'user', content:user }]);
}

async function callGroqValidate(recipe) {
  const system = `Du bist ein Validator fÃ¼r Rezept-Daten. PrÃ¼fe alle Zutaten:
- Wenn amount nicht plausibel oder offensichtlich erfunden â†’ setze auf null
- Wenn unit nicht zu amount passt â†’ setze auf null
- Gib das bereinigte Rezept als JSON zurÃ¼ck
- Antworte NUR mit JSON`;
  const user = `Validiere und bereinige dieses Rezept:\n${JSON.stringify(recipe, null, 2)}`;
  const validated = await callGroq([{ role:'system', content:system }, { role:'user', content:user }]);
  return { ...recipe, ...validated, id: recipe.id };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DETAIL SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let checkedIngredients = new Set();
let editIngCount = 0, editStepCount = 0;

const EMOJI_MAP = [
  ['pasta|spaghetti|penne|tagliatelle|carbonara|tartufini|tiramisÃ¹','ğŸ'],
  ['pizza','ğŸ•'],['burger','ğŸ”'],['sushi|maki','ğŸ£'],['ramen|nudel','ğŸœ'],
  ['salat|salad','ğŸ¥—'],['suppe|soup','ğŸ²'],['taco','ğŸŒ®'],['curry','ğŸ›'],
  ['kuchen|cake|torte','ğŸ°'],['dessert|mousse|tiramisu|tartuf','ğŸ®'],
  ['ei |eier|omelette|frÃ¼hstÃ¼ck','ğŸ³'],['chicken|hÃ¤hnchen|hÃ¼hnchen','ğŸ—'],
  ['fisch|fish|lachs|thunfisch','ğŸŸ'],['steak|beef|rind','ğŸ¥©'],
  ['vegan|gemÃ¼se','ğŸ¥¦'],['brot|bread','ğŸ'],['reis|rice','ğŸš'],
  ['smoothie|shake','ğŸ¥¤'],['cocktail|drink','ğŸ¹'],['kaffee|coffee','â˜•'],
  ['schokolade|chocolate','ğŸ«'],['eis|gelato','ğŸ¨'],
];

function recipeEmoji(r) {
  const text = (r.title + ' ' + (r.cuisine||'') + ' ' + (r.tags||[]).join(' ')).toLowerCase();
  for (const [p, e] of EMOJI_MAP) { if (new RegExp(p).test(text)) return e; }
  return r.is_recipe === false ? 'ğŸ”–' : 'ğŸ½ï¸';
}

function showDetail(id) {
  currentDetailId = id;
  const r = getRecipeById(id);
  if (!r) return;
  checkedIngredients = new Set();
  navTo('detail');
  document.getElementById('bottom-nav').style.display = 'none';

  const emoji = recipeEmoji(r);
  document.getElementById('detail-emoji').textContent = emoji;
  document.getElementById('detail-topbar-title').textContent = r.title;
  document.getElementById('detail-title').textContent = r.title;

  // Confidence badge
  const pct = Math.round((r.confidence||0)*100);
  const cc = r.confidence >= .8 ? 'var(--sage)' : r.confidence >= .5 ? 'var(--amber)' : 'var(--error)';
  const cl = r.confidence >= .8 ? 'Hoch' : r.confidence >= .5 ? 'Mittel' : 'Niedrig';
  document.getElementById('conf-dot').style.background = cc;
  document.getElementById('conf-text').innerHTML = `<span style="color:${cc}">${pct}% Â· ${cl}</span>`;

  // Pills
  const pills = [];
  if (r.duration_min) pills.push(`â± ${r.duration_min} min`);
  if (r.servings) pills.push(`ğŸ½ ${r.servings} Port.`);
  if (r.cuisine) pills.push(`ğŸŒ ${r.cuisine}`);
  if (r.difficulty) pills.push({easy:'âœ… Einfach',medium:'ğŸ“Š Mittel',hard:'âš¡ Schwer'}[r.difficulty]);
  document.getElementById('detail-pills').innerHTML = pills.map(p => `<span class="detail-pill">${p}</span>`).join('');

  // Source
  const srcBtn = document.getElementById('detail-source-btn');
  const srcStrip = document.getElementById('detail-source-strip');
  if (r.source?.url) {
    srcBtn.style.display = 'flex';
    srcStrip.style.display = 'block';
    document.getElementById('detail-source-url-text').textContent = r.source.url.replace(/https?:\/\//,'').slice(0,50);
  } else {
    srcBtn.style.display = 'none';
    srcStrip.style.display = 'none';
  }

  // Reset to first tab
  document.querySelectorAll('.dtab').forEach((b,i) => b.classList.toggle('active', i===0));
  document.querySelectorAll('.tab-pane').forEach((p,i) => p.classList.toggle('active', i===0));
  renderIngredients(r);
  renderSteps(r);
  renderInfo(r);
}

function switchTab(name, btn) {
  document.querySelectorAll('.tab-pane').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.dtab').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  btn.classList.add('active');
  if (name === 'edit') renderEdit(getRecipeById(currentDetailId));
}
function switchTabById(name) {
  const tabs = ['ingredients','steps','info','edit'];
  tabs.forEach((t,i) => {
    document.getElementById('tab-'+t).classList.toggle('active', t===name);
    document.querySelectorAll('.dtab')[i]?.classList.toggle('active', t===name);
  });
  if (name === 'edit') renderEdit(getRecipeById(currentDetailId));
}
function doEditTab() { switchTabById('edit'); }

function openSource() {
  const r = getRecipeById(currentDetailId);
  if (r?.source?.url) window.open(r.source.url, '_blank');
}

// â”€â”€ Ingredient tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderIngredients(r) {
  const ings = r.ingredients || [];
  if (!ings.length) { document.getElementById('tab-ingredients').innerHTML = `<div class="empty"><div class="empty-icon">ğŸ¥—</div><div class="empty-sub">Keine Zutaten extrahiert</div></div>`; return; }
  document.getElementById('tab-ingredients').innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--sp3)">
      <span style="font-size:12px;color:var(--ink3)">${ings.length} Zutat${ings.length!==1?'en':''}</span>
      <button class="reset-btn" onclick="resetChecks()">Reset âœ“</button>
    </div>
    ${ings.map((ing, i) => {
      const checked = checkedIngredients.has(i);
      const amtStr = ing.amount != null
        ? `<span class="ing-amount">${ing.amount}${ing.unit?' '+ing.unit:''}</span>`
        : `<span class="ing-unknown">? UNBEK.</span>`;
      return `<div class="ing-row">
        <div class="ing-cb ${checked?'checked':''}" onclick="toggleCheck(${i})" id="icb-${i}">${checked?'âœ“':''}</div>
        <div style="flex:1">
          <div class="ing-name ${checked?'done':''}" id="iname-${i}">${esc(ing.name)}</div>
          ${ing.note?`<div class="ing-note">${esc(ing.note)}</div>`:''}
        </div>
        ${amtStr}
      </div>`;
    }).join('')}`;
}

function toggleCheck(i) {
  if (checkedIngredients.has(i)) checkedIngredients.delete(i); else checkedIngredients.add(i);
  renderIngredients(getRecipeById(currentDetailId));
}
function resetChecks() { checkedIngredients = new Set(); renderIngredients(getRecipeById(currentDetailId)); }

// â”€â”€ Steps tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSteps(r) {
  const steps = r.steps || [];
  if (!steps.length) { document.getElementById('tab-steps').innerHTML = `<div class="empty"><div class="empty-icon">ğŸ“‹</div><div class="empty-sub">Keine Schritte extrahiert</div></div>`; return; }
  document.getElementById('tab-steps').innerHTML = steps.map((s, i) => `
    <div class="step-row">
      <div class="step-num">${i+1}</div>
      <div class="step-text">${esc(s.text)}</div>
    </div>`).join('');
}

// â”€â”€ Info tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderInfo(r) {
  const dl = {easy:'âœ… Einfach',medium:'ğŸ“Š Mittel',hard:'âš¡ Schwer'}[r.difficulty] || 'â€”';
  const tags = (r.tags||[]).map(t => `<span class="tag-mini">${esc(t)}</span>`).join('');
  document.getElementById('tab-info').innerHTML = `
    <div class="info-row"><span class="info-lbl">KÃ¼che</span><span class="info-val">${r.cuisine||'â€”'}</span></div>
    <div class="info-row"><span class="info-lbl">Schwierigkeit</span><span class="info-val">${dl}</span></div>
    <div class="info-row"><span class="info-lbl">Dauer</span><span class="info-val">${r.duration_min?r.duration_min+' min':'â€”'}</span></div>
    <div class="info-row"><span class="info-lbl">Portionen</span><span class="info-val">${r.servings||'â€”'}</span></div>
    <div class="info-row"><span class="info-lbl">Platform</span><span class="info-val">${r.source?.platform||'â€”'}</span></div>
    ${tags?`<div class="info-row"><span class="info-lbl">Tags</span><div style="display:flex;gap:4px;flex-wrap:wrap">${tags}</div></div>`:''}
    ${r.source?.caption?`<div style="margin-top:var(--sp4)"><div class="label" style="margin-bottom:var(--sp2)">Original Caption</div><div class="text-muted" style="white-space:pre-wrap">${esc(r.source.caption.slice(0,400))}${r.source.caption.length>400?'â€¦':''}</div></div>`:''}
    <div style="margin-top:var(--sp4)">
      <div class="label" style="margin-bottom:var(--sp2)">Notizen</div>
      <textarea class="notes-area" id="notes-area" placeholder="PersÃ¶nliche Notizenâ€¦" onchange="saveNotes()">${esc(r.notes||'')}</textarea>
    </div>`;
}

function saveNotes() {
  const all = getRecipes();
  const idx = all.findIndex(r => r.id === currentDetailId);
  if (idx < 0) return;
  all[idx].notes = document.getElementById('notes-area').value;
  all[idx].updated_at = new Date().toISOString();
  saveRecipes(all);
}

function deleteRecipe(id) {
  if (!confirm('Rezept wirklich lÃ¶schen?')) return;
  saveRecipes(getRecipes().filter(r => r.id !== id));
  showToast('ğŸ—‘ Rezept gelÃ¶scht');
  navTo('cookbook');
}
function deleteCurrentRecipe() { deleteRecipe(currentDetailId); }

// â”€â”€ Edit tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(str) {
  return String(str||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function renderEdit(r) {
  if (!r) return;
  const ings = r.ingredients || [];
  const steps = r.steps || [];
  editIngCount = ings.length;
  editStepCount = steps.length;
  document.getElementById('tab-edit').innerHTML = `
    <div class="gap4">
      <div>
        <div class="label" style="margin-bottom:var(--sp3)">Grundinfo</div>
        <div class="gap3">
          <div><label class="field-label">Titel</label><input class="field-input" id="edit-title" value="${esc(r.title)}"></div>
          <div class="row">
            <div class="field-group"><label class="field-label">KÃ¼che</label><input class="field-input" id="edit-cuisine" value="${esc(r.cuisine||'')}"></div>
            <div class="field-group"><label class="field-label">Schwierigkeit</label>
              <select class="field-input" id="edit-difficulty">
                <option value="">â€”</option>
                <option value="easy" ${r.difficulty==='easy'?'selected':''}>Einfach</option>
                <option value="medium" ${r.difficulty==='medium'?'selected':''}>Mittel</option>
                <option value="hard" ${r.difficulty==='hard'?'selected':''}>Schwer</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="field-group"><label class="field-label">Dauer (Min)</label><input class="field-input" id="edit-duration" type="number" value="${r.duration_min||''}"></div>
            <div class="field-group"><label class="field-label">Portionen</label><input class="field-input" id="edit-servings" type="number" value="${r.servings||''}"></div>
          </div>
        </div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--sp2)">
          <div class="label">Zutaten</div>
          <button class="add-btn" onclick="addIngredient()">+ Zutat</button>
        </div>
        <div id="edit-ingredients">${ings.map((ing,i) => ingEditRow(ing,i)).join('')}</div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--sp2)">
          <div class="label">Schritte</div>
          <button class="add-btn" onclick="addStep()">+ Schritt</button>
        </div>
        <div id="edit-steps">${steps.map((s,i) => stepEditRow(s,i)).join('')}</div>
      </div>
      <button class="btn btn-primary btn-lg" onclick="saveEdits()">ğŸ’¾ Speichern</button>
    </div>`;
}

function ingEditRow(ing, i) {
  return `<div class="edit-ing-row" id="edit-ing-${i}">
    <input class="field-input flex1" placeholder="Zutat" value="${esc(ing.name||'')}" id="ing-name-${i}" style="flex:2">
    <input class="field-input" placeholder="Menge" value="${ing.amount!=null?ing.amount:''}" id="ing-amount-${i}" style="flex:1;min-width:0">
    <input class="field-input" placeholder="Einh." value="${esc(ing.unit||'')}" id="ing-unit-${i}" style="flex:1;min-width:0">
    <button onclick="document.getElementById('edit-ing-${i}').remove()" class="del-btn">âœ•</button>
  </div>`;
}

function stepEditRow(s, i) {
  return `<div class="edit-step-row" id="edit-step-${i}">
    <div class="step-num" style="flex-shrink:0">${i+1}</div>
    <textarea class="field-input" style="flex:1;resize:vertical;min-height:52px" id="step-text-${i}">${esc(s.text||'')}</textarea>
    <button onclick="removeStep(${i})" class="del-btn">âœ•</button>
  </div>`;
}

function addIngredient() {
  const i = editIngCount++;
  const el = document.createElement('div');
  el.innerHTML = ingEditRow({name:'',amount:null,unit:null}, i);
  document.getElementById('edit-ingredients').appendChild(el.firstElementChild);
}
function addStep() {
  const i = editStepCount++;
  const el = document.createElement('div');
  el.innerHTML = stepEditRow({text:''}, i);
  document.getElementById('edit-steps').appendChild(el.firstElementChild);
  document.querySelectorAll('#edit-steps .step-num').forEach((el,idx) => el.textContent = idx+1);
}
function removeStep(i) {
  document.getElementById('edit-step-'+i)?.remove();
  document.querySelectorAll('#edit-steps .step-num').forEach((el,idx) => el.textContent = idx+1);
}

function saveEdits() {
  const all = getRecipes();
  const idx = all.findIndex(r => r.id === currentDetailId);
  if (idx < 0) return;
  const r = all[idx];
  const ingredients = [];
  document.querySelectorAll('[id^="edit-ing-"]').forEach(row => {
    const i = row.id.replace('edit-ing-','');
    const name = document.getElementById('ing-name-'+i)?.value?.trim();
    if (!name) return;
    const amt = document.getElementById('ing-amount-'+i)?.value?.trim();
    const unit = document.getElementById('ing-unit-'+i)?.value?.trim();
    ingredients.push({ id:'i'+i, name, amount:amt?parseFloat(amt)||amt:null, unit:unit||null, note:null, confidence:1 });
  });
  const steps = [];
  document.querySelectorAll('[id^="edit-step-"]').forEach((row,si) => {
    const i = row.id.replace('edit-step-','');
    const text = document.getElementById('step-text-'+i)?.value?.trim();
    if (text) steps.push({ id:'s'+si, text });
  });
  all[idx] = {
    ...r,
    title: document.getElementById('edit-title')?.value?.trim() || r.title,
    cuisine: document.getElementById('edit-cuisine')?.value?.trim() || null,
    duration_min: parseInt(document.getElementById('edit-duration')?.value)||null,
    servings: parseInt(document.getElementById('edit-servings')?.value)||null,
    difficulty: document.getElementById('edit-difficulty')?.value || null,
    ingredients, steps,
    updated_at: new Date().toISOString(),
  };
  saveRecipes(all);
  document.getElementById('detail-topbar-title').textContent = all[idx].title;
  document.getElementById('detail-title').textContent = all[idx].title;
  renderIngredients(all[idx]);
  renderSteps(all[idx]);
  renderInfo(all[idx]);
  showToast('âœ… Rezept gespeichert!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COOKBOOK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const FILTERS = [
  {key:'all',label:'Alle'},{key:'recipe',label:'ğŸ³ Rezepte'},
  {key:'easy',label:'âœ… Einfach'},{key:'quick',label:'âš¡ Schnell'},
  {key:'bookmark',label:'ğŸ”– Gespeichert'},
];
let activeFilter = 'all';
let sortMode = 'newest';

function toggleSort() {
  sortMode = sortMode === 'newest' ? 'alpha' : 'newest';
  document.getElementById('sort-toggle').textContent = sortMode === 'newest' ? 'â†“ Neueste' : 'Aâ†’Z';
  renderCookbook();
}

function renderCookbook() {
  const q = (document.getElementById('search-input')?.value || '').toLowerCase();
  let recipes = getRecipes();
  if (q) recipes = recipes.filter(r => [r.title, r.cuisine, ...(r.tags||[]), ...(r.ingredients||[]).map(i=>i.name)].join(' ').toLowerCase().includes(q));
  if (activeFilter === 'recipe') recipes = recipes.filter(r => r.is_recipe !== false);
  if (activeFilter === 'easy') recipes = recipes.filter(r => r.difficulty === 'easy');
  if (activeFilter === 'quick') recipes = recipes.filter(r => r.duration_min && r.duration_min <= 20);
  if (activeFilter === 'bookmark') recipes = recipes.filter(r => r.is_recipe === false);
  if (sortMode === 'alpha') recipes.sort((a,b) => (a.title||'').localeCompare(b.title||''));
  else recipes.sort((a,b) => new Date(b.created_at)-new Date(a.created_at));

  document.getElementById('filter-row').innerHTML = FILTERS.map(f =>
    `<button class="chip ${activeFilter===f.key?'active':''}" onclick="setFilter('${f.key}')">${f.label}</button>`
  ).join('');
  document.getElementById('recipe-count-label').textContent = `${recipes.length} Rezept${recipes.length!==1?'e':''}`;

  const list = document.getElementById('cookbook-list');
  if (!recipes.length) {
    list.innerHTML = `<div class="empty">
      <div class="empty-icon">ğŸ“–</div>
      <div class="empty-title">Keine Rezepte</div>
      <div class="empty-sub">${q?'Keine Treffer fÃ¼r "'+q+'"':'Noch keine Rezepte gespeichert'}</div>
      ${!q&&!getRecipes().length?`<button class="btn btn-primary btn-md" onclick="addDemoRecipe()" style="margin-top:var(--sp2)">âœ¨ Demo-Rezept</button>`:''}
    </div>`;
    return;
  }
  list.innerHTML = recipes.map(r => recipeCardHTML(r)).join('');
}

function setFilter(key) { activeFilter = key; renderCookbook(); }

function recipeCardHTML(r, showDel = true) {
  const meta = [];
  if (r.duration_min) meta.push(`â± ${r.duration_min}m`);
  if (r.difficulty) meta.push({easy:'âœ… Einfach',medium:'ğŸ“Š Mittel',hard:'âš¡ Schwer'}[r.difficulty]);
  if (r.cuisine) meta.push(r.cuisine);

  const inner = `<div class="rcard" onclick="${showDel?`handleCardClick(event,'${r.id}')`:`showDetail('${r.id}')`}">
    <div class="rcard-thumb">${recipeEmoji(r)}</div>
    <div class="rcard-body">
      <div class="rcard-title">${esc(r.title)}</div>
      <div class="rcard-meta">${meta.join(' Â· ')}</div>
      ${(r.tags||[]).length?`<div class="rcard-tags">${r.tags.slice(0,3).map(t=>`<span class="rcard-tag">${esc(t)}</span>`).join('')}</div>`:''}
    </div>
    <div class="rcard-arrow">â€º</div>
  </div>`;

  if (!showDel) return inner;
  return `<div class="rcard-wrap" id="wrap-${r.id}" oncontextmenu="toggleSwipe(event,'${r.id}')">
    <div class="rcard-del-bg" onclick="confirmDeleteCard('${r.id}')">ğŸ—‘</div>
    ${inner}
  </div>`;
}

function handleCardClick(e, id) {
  const wrap = document.getElementById('wrap-' + id);
  if (wrap?.classList.contains('swiped')) { wrap.classList.remove('swiped'); }
  else { showDetail(id); }
}
function toggleSwipe(e, id) { e.preventDefault(); document.getElementById('wrap-'+id)?.classList.toggle('swiped'); }

// Touch swipe support for cookbook cards
let touchStartX = 0;
document.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; }, {passive:true});
document.addEventListener('touchend', e => {
  const dx = e.changedTouches[0].clientX - touchStartX;
  if (Math.abs(dx) < 50) return;
  const el = e.target.closest('.rcard-wrap');
  if (!el) return;
  if (dx < -50) el.classList.add('swiped');
  else if (dx > 50) el.classList.remove('swiped');
}, {passive:true});

function confirmDeleteCard(id) {
  const r = getRecipeById(id);
  if (!r) return;
  if (!confirm(`"${r.title}" lÃ¶schen?`)) { document.getElementById('wrap-'+id)?.classList.remove('swiped'); return; }
  const el = document.getElementById('wrap-'+id);
  if (el) { el.style.transition='all .25s'; el.style.opacity='0'; el.style.transform='translateX(-100%)'; }
  setTimeout(() => { saveRecipes(getRecipes().filter(r => r.id !== id)); renderCookbook(); showToast('ğŸ—‘ GelÃ¶scht'); }, 250);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function setLangPref(lang, btn) {
  const s = getSettings(); s.language_pref = lang; saveSettings(s);
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  showToast({original:'ğŸŒ Originalsprache',de:'ğŸ‡©ğŸ‡ª Deutsch',en:'ğŸ‡¬ğŸ‡§ English'}[lang]);
}

function refreshSettings() {
  const key = getApiKey();
  document.getElementById('key-input').value = key;
  const count = getRecipes().length;
  document.getElementById('recipes-count-setting').textContent = `${count} Rezept${count!==1?'e':''} gespeichert`;
  const lang = getSettings().language_pref || 'original';
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
}

function saveKey() {
  const k = document.getElementById('key-input').value.trim();
  if (!k) { showToast('Key ist leer'); return; }
  if (!k.startsWith('gsk_')) { showToast('Key muss mit gsk_ beginnen'); return; }
  setApiKey(k); showToast('âœ… API Key gespeichert');
}
function toggleKeyVisibility() {
  const inp = document.getElementById('key-input');
  inp.type = inp.type === 'password' ? 'text' : 'password';
}
function deleteKey() {
  if (!confirm('API Key lÃ¶schen?')) return;
  const s = getSettings(); delete s.groq_key; saveSettings(s);
  document.getElementById('key-input').value = ''; showToast('Key gelÃ¶scht');
}
function deleteAllRecipes() {
  if (!confirm('Alle Rezepte wirklich lÃ¶schen?')) return;
  saveRecipes([]); refreshSettings(); showToast('Alle Rezepte gelÃ¶scht');
}

async function testApiKey() {
  const key = document.getElementById('key-input').value.trim() || getApiKey();
  if (!key) { showToast('Bitte Key eingeben'); return; }
  const btn = document.getElementById('test-key-btn');
  const box = document.getElementById('test-result');
  btn.textContent = 'â³'; btn.disabled = true; box.style.display = 'none';
  try {
    const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+key},
      body:JSON.stringify({model:'llama-3.3-70b-versatile',max_tokens:5,messages:[{role:'user',content:'Say OK'}]}),
    });
    const data = await res.json();
    box.style.display = 'block';
    if (res.ok) { box.className='test-result test-ok'; box.textContent='âœ“ Verbindung erfolgreich! Groq antwortet.'; }
    else { box.className='test-result test-fail'; box.textContent='âœ— Fehler '+res.status+': '+(data?.error?.message||'Unbekannt'); }
  } catch(e) {
    box.style.display='block'; box.className='test-result test-fail'; box.textContent='âœ— Netzwerkfehler: '+e.message;
  }
  btn.textContent='ğŸ”— Testen'; btn.disabled=false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEMO RECIPE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addDemoRecipe() {
  upsertRecipe({
    id:newId(), title:'Pasta Carbonara', cuisine:'Italienisch', duration_min:25, servings:4, difficulty:'medium',
    ingredients:[
      {id:'i0',name:'Spaghetti',amount:400,unit:'g',note:null,confidence:1},
      {id:'i1',name:'Pancetta',amount:150,unit:'g',note:'gewÃ¼rfelt',confidence:1},
      {id:'i2',name:'Eigelbe',amount:4,unit:null,note:null,confidence:1},
      {id:'i3',name:'Pecorino Romano',amount:80,unit:'g',note:'gerieben',confidence:1},
      {id:'i4',name:'Schwarzer Pfeffer',amount:null,unit:null,note:'frisch gemahlen',confidence:.8},
    ],
    steps:[
      {id:'s0',text:'Pasta in reichlich Salzwasser al dente kochen. 1 Tasse Kochwasser aufbewahren.'},
      {id:'s1',text:'Pancetta in einer Pfanne ohne Ã–l knusprig braten, dann beiseitestellen.'},
      {id:'s2',text:'Eigelbe mit geriebenem Pecorino und viel schwarzem Pfeffer verquirlen.'},
      {id:'s3',text:'Abgetropfte Pasta in die Pfanne geben. Hitze aus. Ei-Mischung einrÃ¼hren.'},
      {id:'s4',text:'Etwas Kochwasser dazugeben und cremig rÃ¼hren. Mit Pancetta servieren.'},
    ],
    tags:['Pasta','Klassiker','Italienisch'],
    source:{platform:null,url:null,caption:null},
    transcript:{text:null,method:null},
    is_recipe:true, confidence:.95, reason:'Demo-Rezept',
    created_at:new Date().toISOString(), updated_at:new Date().toISOString(), notes:'',
  });
  renderCookbook();
  showToast('ğŸ Demo-Rezept hinzugefÃ¼gt!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEBUG ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const DEBUG_KEY = 'reelrecipes_debug';
let debugEnabled = false;
let debugLog = [];
let debugFilter = 'all';

function isDebugEnabled() { try { return JSON.parse(localStorage.getItem(DEBUG_KEY)||'false'); } catch { return false; } }
function toggleDebugMode() {
  debugEnabled = document.getElementById('debug-enabled-toggle').checked;
  localStorage.setItem(DEBUG_KEY, JSON.stringify(debugEnabled));
  showToast(debugEnabled ? 'ğŸ› Debug aktiv' : 'Debug deaktiviert');
}

function dbg(level, msg, detail = null) {
  if (!debugEnabled && level !== 'error') return;
  const entry = { t:new Date().toISOString(), level, msg:typeof msg==='object'?JSON.stringify(msg,null,2):String(msg), detail:detail?(typeof detail==='object'?JSON.stringify(detail,null,2):String(detail)):null };
  debugLog.push(entry);
  const fn = level==='error'?console.error:level==='warn'?console.warn:console.log;
  fn('[ReelRecipes]['+level.toUpperCase()+']', entry.msg, detail||'');
  renderDebugEntry(entry);
}

function renderDebugEntry(entry) {
  const list = document.getElementById('debug-log-list');
  if (!list) return;
  const empty = list.querySelector('[style*="Debug-Log leer"]');
  if (empty) empty.remove();
  if (debugFilter !== 'all' && entry.level !== debugFilter) return;
  const colors = {info:'#58A6FF',stage:'#3FB950',api:'#D2A8FF',error:'#F85149',warn:'#E3B341',audio:'#79C0FF'};
  const icons  = {info:'â„¹ï¸',stage:'âš™ï¸',api:'ğŸ¤–',error:'ğŸ”´',warn:'âš ï¸',audio:'ğŸ™'};
  const time = entry.t.split('T')[1].slice(0,12);
  const el = document.createElement('div');
  el.className = `dbg-entry ${entry.level}`;
  el.innerHTML = `<span class="dbg-time">${time}</span><span class="dbg-level" style="color:${colors[entry.level]||'#8B949E'}">${icons[entry.level]||'Â·'} ${entry.level.toUpperCase()}</span><span class="dbg-msg">${escHtml(entry.msg)}</span>${entry.detail?`<div class="dbg-detail">${escHtml(entry.detail)}</div>`:''}`;
  if (entry.detail) el.addEventListener('click', () => el.classList.toggle('open'));
  list.appendChild(el);
  list.scrollTop = list.scrollHeight;
}

function escHtml(str) { return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function setDebugFilter(f, btn) {
  debugFilter = f;
  document.querySelectorAll('#debug-filter-row .chip').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  rerenderDebugLog();
}

function rerenderDebugLog() {
  const list = document.getElementById('debug-log-list');
  list.innerHTML = '';
  const filtered = debugFilter==='all'?debugLog:debugLog.filter(e=>e.level===debugFilter);
  if (!filtered.length) { list.innerHTML='<div style="color:#8B949E;padding:8px 0">â€” Keine EintrÃ¤ge â€”</div>'; return; }
  filtered.forEach(renderDebugEntry);
}

function refreshDebugScreen() {
  const toggle = document.getElementById('debug-enabled-toggle');
  if (toggle) toggle.checked = isDebugEnabled();
  debugEnabled = isDebugEnabled();
  rerenderDebugLog();
}

function clearDebugLog() {
  debugLog = [];
  const list = document.getElementById('debug-log-list');
  list.innerHTML = '<div style="color:#8B949E;padding:8px 0">â€” Log gelÃ¶scht â€”</div>';
}

function copyDebugLog() {
  const text = debugLog.map(e=>`[${e.t}][${e.level.toUpperCase()}] ${e.msg}${e.detail?'\n'+e.detail:''}`).join('\n');
  navigator.clipboard.writeText(text).then(()=>showToast('ğŸ“‹ Log kopiert'));
}

function downloadDebugLog() {
  const text = debugLog.map(e=>`[${e.t}][${e.level.toUpperCase()}] ${e.msg}${e.detail?'\n---\n'+e.detail+'\n---':''}`).join('\n\n');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text],{type:'text/plain'}));
  a.download = 'reelrecipes-debug-'+new Date().toISOString().slice(0,19).replace(/:/g,'-')+'.txt';
  a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
debugEnabled = isDebugEnabled();
if (!getApiKey()) setApiKey('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');
navTo('home');
</script>
</body>
</html>
